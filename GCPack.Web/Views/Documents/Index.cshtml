@model IEnumerable<GCPack.Model.DocumentModel>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@if (ViewBag.Message != null)
{
    <script>
        //zobrazi hlasku y dokumentu
        $(document).ready(function () {
                        $('#success-alert').html('@ViewBag.Message');
                        $("#success-alert").fadeTo(2000, 500).slideUp(500, function () {
                        $("#success-alert").slideUp(500);
                        });
            });
    </script>
}
    <script>
        var timeoutHandle;
        var orderBy = '';
        $(document).ready(function () {
            GetDocuments();
            // vsechnz talcitka na trideni jsou zalozany na  css class sortBy
                $('.sortBy').click(
                    function () {
                        orderBy = $(this).attr('sortBy');
                        GetDocuments();
                    }
                );

                $('.filter').keyup(function () {
                    GetDocuments();
                });

                $('#DocumentTypeID , #ProjectID, #DivisionID, #AppSystemID, #WorkplaceID').change(function () {
                    GetDocuments();
                });

            });

        function GetDocuments() {
                // nastaven 500mlisec spoydeni na cekani bna vlozeni vstupu z klavesnice
                if (timeoutHandle != null) window.clearTimeout(timeoutHandle);

                timeoutHandle = setTimeout(
                    function () {

                        //$('table').children('.data').empty();
                        $.getJSON(AppRoot + "/documents/getDocuments", {
                            name: $('#Name').val(),
                            Number: $('#Number').val(),
                            AdministratorName: $('#AdministratorName').val(),
                            DocumentTypeID: $('#DocumentTypeID').val(),
                            OrderBy: orderBy,
                            ProjectID: $('#ProjectID').val(),
                            DivisionID: $('#DivisionID').val(),
                            AppSystemID: $('#AppSystemID').val(),
                            WorkplaceID: $('#WorkplaceID').val()                            
                        })
                            .done(function (documents) {
                                $('table .dataRow').remove();
                                $.each(documents, function (index, doc) {

                                    var dateStr = "";
                                    if (doc.EffeciencyDate != null)
                                    {
                                        var date = eval(doc.EffeciencyDate.replace(/\/Date\((\d+)\)\//gi, "new Date($1)"));
                                        dateStr =
                                            date.getDate() + "." + (date.getMonth() + 1) + "." + date.getFullYear();
                                    }

                                    $('table').append('<tr class="dataRow">' +
                                        '<td> ' + doc.Title + '</td>' +
                                        '<td> ' + doc.DocumentNumber + ' (Verze dokumentu: ' + doc.IssueNumber + ')</td>' +
                                        '<td> ' + dateStr + '</td>' +
                                        '<td> ' + doc.DocumentAdministrator + '</td>' +
                                        '<td> <A class="btn btn-default btn-sm" href="' + AppRoot + '/Documents/Edit?documentId=' + doc.ID +
                                        '">Upravit</A> <A class="btn btn-default btn-sm" href="' + AppRoot + '/Documents/Details?documentId=' + doc.ID +
                                        '">Zobrazit</A> <A class="btn btn-default btn-sm" href="' + AppRoot + '/Documents/Delete?documentId=' + doc.ID +
                                        '">Smazat</A> </td>'
                                    );
                                });

                            })
                            .fail(function (jqxhr, textStatus, error) {
                                var err = textStatus + ", " + error;
                                console.log("Request Failed: " + err);
                            });


                    },
                    500);
            }


    </script>

<div style="position:relative">
    <div id="success-alert" class="alert alert-success" style="display:none;position:absolute;top:10px;right:0px"></div>
</div>
<h2>Dokumenty</h2>

<script>
        $(document).ready(function () {
            $("#section-filter-plus1").on("hide.bs.collapse", function () {
                $(".btn.btn-success").html('<span class="glyphicon glyphicon-collapse-down"></span> +');
                $("#DocumentTypeID").val(0);
                $("#ProjectID").val(0);
                $("#DivisionID").val(0);
                $("#AppSystemID").val(0);
                $("#WorkplaceID").val(0);
                GetDocuments();
            });

            $("#section-filter-plus1").on("show.bs.collapse", function () {
                $(".btn.btn-success").html('<span class="glyphicon glyphicon-collapse-up"></span> -');
            });

            $('#divisionsFilter').keyup(function () {
                filterCodeList($(this).val(), '#DivisionID');
            });

            $('#projectsFilter').keyup(function () {
                filterCodeList($(this).val(), '#ProjectID');
            });

            $('#appSystemsFilter').keyup(function () {
                filterCodeList($(this).val(), '#AppSystemID');
            });

            $('#workplacesFilter').keyup(function () {
                filterCodeList($(this).val(), '#WorkplaceID');
            });

            // tato funkce je spolecna pro Index a Edit - bude lepsi ji dat nekam do spolecneho mista
            // zatim tomu tak neni 18.6.2017 LF
            function filterCodeList(filter, codeList) {
                $(codeList + ' option').each(function () {
                    if ($(this).text().toLowerCase().indexOf(filter.toLowerCase()) > -1) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                })
            };
        });


      


</script>

<div class="row">
    <div class="col-md-2">
        <label for="Name">Název dokumentu</label>
    </div>
    <div class="col-md-2">
        <label for="Number">Číslo dokumentu</label>
    </div>
    <div class="col-md-2">
        <label for="AdministratorName">Administrátor</label>
    </div>
    <div class="col-md-2">
        <button type="button" class="btn btn-success" data-toggle="collapse" data-target="#section-filter-plus1">
            <span class="glyphicon glyphicon-collapse-down"></span> +
        </button>
    </div>
</div>
<div class="row">
    <div class="col-md-2">
        <input class="filter" type="text" id="Name" />
    </div>
    <div class="col-md-2">
        <input class="filter" type="text" id="Number" />
    </div>
    <div class="col-md-2">
        <input class="filter" type="text" id="AdministratorName" />
    </div>
    <div class="col-md-2">
    </div>
</div>

<div id="section-filter-plus1" class="collapse">

    <div class="row">
        <div class="col-md-2">
            <label for="DocumentTypeID">Typ dokumentu</label>
        </div>
        <div class="col-md-2">
            <label for="ProjectID">Project</label>
        </div>

        <div class="col-md-2">
            <label for="DivisionID">Středisko</label>
        </div>
        <div class="col-md-2">
            <label for="AppSystemID">Systém</label>
        </div>
        <div class="col-md-2">
            <label for="WorkplaceID">Pracoviště</label>
        </div>
    </div>

    <div class="row">
        <div class="col-md-2">
        </div>
        <div class="col-md-2">
            <input type="text" id="projectsFilter" />
        </div>

        <div class="col-md-2">
            divisionsFilter
        </div>

        <div class="col-md-2">
            appSytemsFilter
        </div>

        <div class="col-md-2">
            workplacesFilter
            
        </div>

    </div>

    <div class="row">
        <div class="col-md-2">
            @Html.DropDownList("DocumentTypeID", new SelectList(ViewBag.DocumentTypes, "ID", "Value"))
        </div>
        <div class="col-md-2">
            @Html.DropDownList("ProjectID", new SelectList(ViewBag.Projects, "ID", "Name"))
        </div>

        <div class="col-md-2">
            @Html.DropDownList("DivisionID", new SelectList(ViewBag.Divisions, "ID", "Name"))
        </div>

        <div class="col-md-2">
            @Html.DropDownList("AppSystemID", new SelectList(ViewBag.AppSystems, "ID", "Name"))
        </div>

        <div class="col-md-2">
            @Html.DropDownList("WorkplaceID", new SelectList(ViewBag.Workplaces, "ID", "Name"))
        </div>

    </div>
</div>

<table class="table" style="margin-top:20px">
    <tr>
        <th>
            Název
            <a href="#" class="sortBy" sortBy="NameA"><span class="glyphicon glyphicon glyphicon-circle-arrow-up "></span></a>
            <a href="#" class="sortBy" sortBy="NameD"><span class="glyphicon glyphicon glyphicon-circle-arrow-down "></span></a>
        </th>
        <th>
            Číslo dokumentu
            <a href="#" class="sortBy" sortBy="NumberA"><span class="glyphicon glyphicon glyphicon-circle-arrow-up "></span></a>
            <a href="#" class="sortBy" sortBy="NumberD"><span class="glyphicon glyphicon glyphicon-circle-arrow-down "></span></a>
        </th>
        <th>
            Datum účinnosti
            <a href="#" class="sortBy" sortBy="RevisionA"><span class="glyphicon glyphicon glyphicon-circle-arrow-up "></span></a>
            <a href="#" class="sortBy" sortBy="RevisionD"><span class="glyphicon glyphicon glyphicon-circle-arrow-down "></span></a>
        </th>
        <th>
            Správce
            <a href="#" class="sortBy" sortBy="AdminA"><span class="glyphicon glyphicon glyphicon-circle-arrow-up "></span></a>
            <a href="#" class="sortBy" sortBy="AdminD"><span class="glyphicon glyphicon glyphicon-circle-arrow-down "></span></a>
        </th>

        <th></th>
    </tr>
</table>
